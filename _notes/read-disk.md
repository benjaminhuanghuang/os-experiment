# 汇编读写磁盘的两种模式（LBA(Logic Block Address) mode 和 CHS mode)

在LBA模式下，系统把所有的物理扇区都按照某种方式或规则看做是一线性编号的扇区，即从0到某个最大值方式排列，把LBA作为一个整体来对待，而不再是具体到实际的C/H/S值，
这样只用一个序数就能确定一个唯一的物理扇区。

用C表示当前柱面号，H表示当前磁头号，S表示当前扇区号，CS表示起始柱面号，HS表示起始磁头号，SS表示起始扇区号，PS表示每磁道有多少个扇区，PH表示每柱面有多少个磁道，计算公式如下：
```
       LBA = ( C – CS ) * PH * PS + ( H – HS ) * PS + ( S – SS )
```

chs方式 ：小于8G (8064MB)

LBA28方式：小于137GB

LBA48方式：小于144,000,000 GB

LBA方式访问使用了data寄存器，LBA寄存器（总共3个），device寄存器，command寄存器来完成的。


## LBA 28 Mode
LBA28方式使用28位来描述一个扇区地址，最大支持128GB的硬磁盘容量。

LBA28就是使用28个比特长度来表示逻辑扇区号，从0x0000000到0xFFFFFFF，一共可以表示268435456个扇区，每个扇区占用512个字节，

故可以管理268435456 * 512 = 128GB硬盘容量, 

个人计算机上的主硬盘控制器被分配了8个端口,端口号从 0x1f0 到 0x1f7。


0x1f0 ;1个16位的端口，连续取出数据
0x1f1 ;错误寄存器，包含硬盘驱动器最后一次执行命令后的状态(错误原因）
0x1f2 ;读取的扇区数量
0x1f3 ;逻辑地址的0~7位
0x1f4 ;逻辑地址的8~15位
0x1f5 ;逻辑地址的16~23位
0x1f6 ;低4位存放逻辑地址的24~27位，第四位表示硬盘号，0表示主盘，1表示从盘，高3位是111,表示LAB模式
0x1f7 ;命令端口同时也是状态端口，0x20表示读取，当为状态端口时，各位代表意思如下图



## CHS mod 
chs模式就是通过设置磁头号，磁道号，扇区号，调用BIOS的0x13的2号功能进行读取磁盘扇区